<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>Bing Maps</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<!-- Bing Maps v7 -->
	<script type="text/javascript" src="http://dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0"></script>

	<!-- jQuery -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>

	<!-- Infobox extension -->
	<script src="ve7.infobox.js" type="text/javascript"></script>
	
	<!-- Optional infobox theme -->
	<link href="ve7.infobox.css" type="text/css" rel="stylesheet" />
</head>
<body>



<div id="myMap" style="position: relative; width: 800px; height: 600px;"></div>


<script type="text/javascript">
jQuery(document).ready(function($){ 

	// Create a Map using v7
	var map = new Microsoft.Maps.Map(
		document.getElementById("myMap"),
		{
			credentials: "ApCafCM70do2i2zj7CA6sz25e4B7D8lszrn-tGtfb7zfjdlcL-goxYY8rJ1AgH3y",
			center: new Microsoft.Maps.Location(-5, 30),
			zoom: 3,
			showDashboard: false,
			showLogo: false,
			showCopyright: false,
			showScalebar: false,
			enableSearchLogo: false,
			mapTypeId: Microsoft.Maps.MapTypeId.road
		}
	);


	// Pin 1: Standard autogenerated infobox 
	var pin1 = map.AddPushpin(
		new Microsoft.Maps.Location(25, 0),
		{
			text: '1',

			// Standard infobox settings
			title: 'Standard (non-sticky) infobox',
			description: 'This infobox has been generated using both the <b>title</b> and the <b>description</b> options and is styled by CSS.'
		}
	);


	// Pin 2: Custom infobox
	var pin2 = map.AddPushpin(
		new Microsoft.Maps.Location(0, 0),
		{
			text: '2',
			sticky: true,

			// Custom infobox
			infobox: $('<span>Sticky and custom infobox using arbitrary HTML code</span>')
		}
	);	
	

	// Pin 3: Custom infobox where a part of the contents use an anonymous event handler
	var custom_contents =  $('<div>Custom infobox with custom event listeners on its children. Only the button triggers the event listener, not the rest of the custom infobox.</div>');
	$('<button>This button has an anonymous event handler</button>')
	 .click(function(){ alert('The button was clicked'); })
	 .appendTo(custom_contents);

	var pin3 = map.AddPushpin(
		new Microsoft.Maps.Location(-25, 0),
		{
			text: '3',
			sticky: true,

			// Custom infobox
			infobox: custom_contents
		}
	);

	// Open the infoboxes without requiring user interaction
	pin1.ShowInfoBox();
	pin2.ShowInfoBox();
	pin3.ShowInfoBox();

});
</script>


<!--
## About
  This extension requires jQuery (because it's faster to create a working prototype than without),
  however it would be best to have a version that does not depend on it.
  Also, it seems that v7 uses the Gimme framework; however I never used it, but this might be an interesting lead.


## The following methods are added to the Pushpin objects:
  Microsoft.Maps.Pushpin.ShowInfoBox()
  Microsoft.Maps.Pushpin.HideInfoBox()
  Microsoft.Maps.Pushpin.ToggleInfoBox()


## The following method must be used to create Pushpin (until I find a way to receive the "entityAdded" event):
  Microsoft.Maps.Map.AddPushpin(location, options)


## The following additional options are supported when creating a Pushpin:

  title: String
    [Standard infoboxes] Used to generate the first half of the infobox

  description: String
    [Standard infoboxes] Used to generate the second half of the infobox


  infobox: HTMLElement created by jQuery.
    [Custom infoboxes] When provided, this value overrides the contents autogenerated by "title" and "description".
	
    And because it's a jQuery element, you can go crazy and create advanced infobox structures very easily
    or use anonymous event handlers. You can also use "Pushpin.infobox" as context in "$(selector, context)"
    or "Pushpin.infobox.find(selector)" queries.
	
    Also, you can still manually trigger [jquery] event handlers from contents elements
    even if the infobox is hidden because the infobox elements are not deleted 
    when closing the infobox, only hidden.
    They are deleted when the pin is removed from the map.

    You could even use the jQuery Template plugin that Microsoft recently donated for example.

	
  sticky: Boolean
    When "true", the infobox is not automatically open when you mouseover the pin, nor does it close when you mouseout the pin.
	Instead, it opens/closes when you click the pin or by calling ShowInfoBox/HideInfobox/ToggleInfoBox.
	When the map pans or zooms, the infoboxes are hidden during the animation (for multiple reasons, performance being the first but not the only one), then displayed back when it stops moving.
	
    I would suggest to use this option only with custom infoboxes that start non-sticky,
    and a button in the infobox toggles the stickiness.



## Future modifications and known bugs:

 - [high] moving a draggable pin seems to interfer with the sticky infoboxes
 
 - [high] moving a draggable pin should update the position of its infobox as well

 - [high] find a way to receive Map.entities events properly because currently, the listeners are set but are never triggered,
   which forces the use of Map.AddPushpin to create pins instead of the regular way.
   
 - [medium] Alignment relative to the pin: currently it aligns at the right of the bottom-center,
   but it should display on the left when the pin is close to the right edga for example.

 - [medium] An arrow on the side of the infobox that points to the pin, depending on the alignment

 - [medium] Better handling of Pushpin.setOptions, e.g. if a standard infobox turns into a custom infobox at a later stage.

 - [medium] if a Pushpin is created with title "Hello", then Pushpin.setOptions is called with a parameter 
    that doesn't contain the "title" field, should it replace the title by NULL or assume that it shouldn't
	modify the existing value (that would be the jquery philosophy, but that may not be what should be assumed here) ?
	Currently, it changes the value to NULL (first case).
 
 - [low] ShowInfoBox maybe should take an optional parameter to convert the infobox as sticky

 - [low] get rid of the jquery dependency

-->


</body>
</html>